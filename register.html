<!DOCTYPE HTML>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Register | CybriaGames</title>
        <meta name="description" content="ðŸ•¹CybriaGames is an unblocked game site hosting over 100+ unblocked games where the danger of internet restrictions dosent apply.">
        <meta name="keywords" content="games, game, gaming, unblocked games, ubg, unblocked game, cybriagames unblocked, cybria games, cyberia games, cybriagame, cyberiagames">
        <meta name="author" content="CybriaTech">
        <link rel="stylesheet" href="/style/users.css">
        <link rel="stylesheet" href="/style/all.css">
        <link rel="icon" href="/images/cybriagames/favicon-circle.png">
    </head>
    <body>
        <script src="/scripts/inject/header.js"></script>
  <main>
    <div id="cloud">
      <h1 class="user-titles">Register</h1>
      <label>
        <p class="username-txt">Username</p>
      </label>
      <input placeholder="Create A Username" id="username">
      <p class="123">Error 123 - Identical Username</p>
      <label>
        <p class="username-txt">Password</p>
      </label>
      <input placeholder="Create A Password" type="password" readonly onfocus="this.removeAttribute('readonly');" id="password-input">
      <div id="forgot-remember">
        <div id="remember">
          <input type="checkbox" id="remember-checkbox">
          <label for="remember-checkbox">Remember Me</label>
        </div>
        <a href="#" id="forgot-password">Forgot Password?</a>
      </div>
      <button class="submit">Register</button>
      <br>
      <div class="newacc">
        <span>Have An Account?</span>
        <button class="signup" onclick="window.location.href='login.html';">Login</button>
      </div>
        <p class="agre">By registering, you agree with the <a href="/tos.html" target="_blank">Chat Terms Of Service (TOS)</a></p>
    </div>
  </main>
        <div class="space" style="margin-bottom: 5%;"></div>
        <script src="/scripts/inject/footer.js"></script>
        <script>
            $(document).ready(async function() {
                
                const response = await fetch('/json/firebase.config.json');
                const firebaseConfig = await response.json();

                firebase.initializeApp(firebaseConfig);
                const db = firebase.database();

                const a1 = $('#username');
                const b2 = $('#password-input');
                const d4 = $('.submit');

                const ipoutpt = await fetch('https://api.ipify.org?format=json');
                const output = await ipoutpt.json();
                const c3 = output.ip;

                function genid() {
                    const chars = '0123456789';
                    let key = '';
                    for (let i = 0; i < 12; i++) {
                        key += chars.charAt(Math.floor(Math.random() * chars.length));
                    }
                    return key;
                }

                async function identical(name) {
                    const snapshot = await db.ref('Users').orderByChild('name').equalTo(name).once('value');
                    return snapshot.exists();
                }

                async function reviews(ip) {
                    const snapshot = await db.ref('Users').orderByChild('ip').equalTo(ip).once('value');
                    return snapshot.exists();
                }

                const ifexist = await reviews(c3);
                if (ifexist) {
                    window.location.href="/";
                }

                d4.on('keydown', async function(event) {
                    if (event.key === 'Enter') {
                        const userNAME = a1.val().trim();
                        const passWORD = b2.val().trim();
                        const ipADDRESS = c3;
                        if (userNAME && passWORD) {
                            const nameExists = await identical(userNAME);
                            if (nameExists) {
                                $('.123').show();
                            } else {
                                const userID = genid();
                                await db.ref('Users').push({
                                    name: userNAME,
                                    id: userID,
                                    password: passWORD,
                                    ip: ipADDRESS
                                });
                                $('#selectname').hide();
                                localStorage.setItem('reqname', 'true');
                            }
                        } else {
                            $('.632').show();
                        }
                    }
                });
            });
        </script>
    </body>
</html>
